<section class="dashboard bg-gray-200 h-[100vh] flex justify-center py-4 px-2 ">

    <form 
    id="form"
        class="p-4 rounded-sm border border-gray-400 bg-white  w-[380px] flex flex-col gap-4 justify-between border-r-2 border-b-4 border-gray-800">
        <div class="flex gap-2">
            <a href="/users/dashboard"
                class="border-r-4 border-b-4 border-blue-800 rounded-sm p-2 cursor-pointer hover:border-r-0 hover:border-b-0 hover:border-l-4 hover:border-t-4 hover:bg-gray-100 duration-100">back</a>
            <h1 class="text-3xl font-bold">Chat Room</h1>
        </div>
        <div class="border border-gray-200 rounded-sm p-2 overflow-y-scroll flex-1">
            <ul id="messages"></ul>
        </div>
        <div>
            <input type="text" id="message-input" class="p-2 border border-gray-200 outline-none rounded-sm" placeholder="Enter a message">
            <button
                class="border-r-4 border-b-4 border-blue-800 rounded-sm p-2 cursor-pointer hover:border-r-0 hover:border-b-0 hover:border-l-4 hover:border-t-4 hover:bg-gray-100 duration-100">Send</button>
        </div>

    </form>



</section>


<script>
    const socket = new WebSocket(`ws://${window.location.host}`)
    const form = document.getElementById('form')
    const input = document.getElementById("message-input")
    const messages = document.getElementById("messages")
    // send message to the server
    socket.onopen = () => {
        socket.send("Hello, from the client")
    }

    // receive message from the server
    socket.onmessage = (event) => {
        const li = document.createElement('li');
        li.textContent = event.data;
        messages.append(li)
    }


    form.addEventListener("submit", (e) => {
        e.preventDefault();
        const msg = input.value;
        socket.send(`<%= user.username %>: ${msg}`)
        input.value = ''
    })


</script>
<section class="h-[100vh] flex justify-center py-4 px-2 ">

    <form id="form" class="p-4 box rounded-sm sm:w-1/2  flex flex-col gap-4 justify-between">
        <div class="flex gap-2">
            <a href="/users/dashboard" class="box p-2 rounded-sm hover:shadow-md"><i>back</i></a>
            <h1 class="text-3xl font-bold">Public Chat Room 🌏</h1>
        </div>
        <div class="border border-gray-200 rounded-sm p-2 overflow-y-scroll flex-1">
            <ul id="messages"></ul>
        </div>
        <div class="flex gap-2">
            <input type="text" id="message-input" class="flex-1 p-2 border border-gray-200 outline-none rounded-sm"
                placeholder="Enter a message">
            <button class="p-2 box text-black  cursor-pointer">Send</button>
        </div>

    </form>



</section>


<script>
    const socket = new WebSocket(`ws://${window.location.host}`)
    const form = document.getElementById('form')
    const input = document.getElementById("message-input")
    const messages = document.getElementById("messages")
    // send message to the server
    socket.onopen = () => {
        socket.send("<%= user.username %> joined the chat.")
    }

    // receive message from the server
    socket.onmessage = (event) => {
        const li = document.createElement('li');
        li.textContent = event.data;
        messages.append(li)
    }


    form.addEventListener("submit", (e) => {
        e.preventDefault();
        const msg = input.value;
        socket.send(`<%= user.username %>: ${msg}`)
        input.value = ''
    })


</script>